{
  "name": "02 ‚Äî –í–∏–¥–µ–æ-—Ñ–∞–±—Ä–∏–∫–∞",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "video-factory",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "üì• Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [200, 400],
      "webhookId": "video-factory"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst body = input.body || input;\n\nconst sessionId = body.session_id;\nif (!sessionId) throw new Error('session_id is required');\n\nreturn [{ json: {\n  session_id: sessionId,\n  idea_id: body.idea_id,\n  voice_script_id: body.voice_script_id,\n  video_prompt_id: body.video_prompt_id,\n  product_image_url: body.product_image_url || '',\n  artikul: body.artikul || '',\n  show_artikul: body.show_artikul || false,\n  tts_provider: body.tts_provider || 'openai',\n  tts_voice: body.tts_voice || 'alloy',\n  tts_speed: body.tts_speed || 1.0,\n  video_provider: body.video_provider || 'minimax',\n  subtitle_font: body.subtitle_font || 'Arial',\n  subtitle_size: body.subtitle_size || 42,\n  subtitle_color: body.subtitle_color || 'white',\n  subtitle_outline: body.subtitle_outline || 2,\n  watermark_url: body.watermark_url || '',\n  watermark_position: body.watermark_position || 'top-right',\n  watermark_opacity: body.watermark_opacity || 0.7\n}}];"
      },
      "id": "validate-input",
      "name": "üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 400]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"success\": true, \"session_id\": {{ $json.session_id }}, \"message\": \"Pipeline started\" }",
        "options": {}
      },
      "id": "respond-immediately",
      "name": "‚úÖ –û—Ç–≤–µ—Ç 200",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [680, 240]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET status = 'processing', current_step = 'loading_data', updated_at = NOW()\nWHERE id = {{ $json.session_id }};\n\nSELECT vs.script_text, vs.timing_marks, vp.prompt_text, vp.scene_descriptions, vp.style_reference,\n       ci.title, ci.concept, ci.visual_description\nFROM pipeline_sessions ps\nLEFT JOIN voice_scripts vs ON vs.id = ps.voice_script_id\nLEFT JOIN video_prompts vp ON vp.id = ps.video_prompt_id\nLEFT JOIN content_ideas ci ON ci.id = ps.idea_id\nWHERE ps.id = {{ $json.session_id }};",
        "options": {}
      },
      "id": "load-data",
      "name": "üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [680, 560],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const dbData = $input.first().json;\nconst params = $('üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞').first().json;\n\nreturn [{ json: {\n  ...params,\n  script_text: dbData.script_text || '',\n  timing_marks: dbData.timing_marks || [],\n  prompt_text: dbData.prompt_text || '',\n  scene_descriptions: dbData.scene_descriptions || [],\n  style_reference: dbData.style_reference || '',\n  title: dbData.title || '',\n  concept: dbData.concept || '',\n  visual_description: dbData.visual_description || ''\n}}];"
      },
      "id": "merge-data",
      "name": "üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [940, 560]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET current_step = 'tts', updated_at = NOW() WHERE id = {{ $json.session_id }};",
        "options": {}
      },
      "id": "update-step-tts",
      "name": "üìå –®–∞–≥ ‚Üí TTS",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [1180, 560],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.openai.com/v1/audio/speech",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"tts-1\",\n  \"input\": \"{{ $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.script_text }}\",\n  \"voice\": \"{{ $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.tts_voice || 'alloy' }}\",\n  \"speed\": {{ $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.tts_speed || 1.0 }},\n  \"response_format\": \"mp3\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          },
          "timeout": 120000
        }
      },
      "id": "tts-generate",
      "name": "üîä TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1420, 560],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TTS_CREDENTIAL_ID",
          "name": "TTS Provider (OpenAI / ElevenLabs)"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const sessionId = $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.session_id;\nconst binaryData = $input.first().binary;\n\nif (!binaryData || !binaryData.data) {\n  throw new Error('TTS –Ω–µ –≤–µ—Ä–Ω—É–ª –∞—É–¥–∏–æ—Ñ–∞–π–ª');\n}\n\nreturn [{\n  json: {\n    session_id: sessionId,\n    voice_file_name: `voice_${sessionId}.mp3`,\n    ...$('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json\n  },\n  binary: binaryData\n}];"
      },
      "id": "process-tts",
      "name": "üéµ –û–±—Ä–∞–±–æ—Ç–∫–∞ TTS",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1660, 560]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET current_step = 'video_generation', voice_file_url = '/output/voice_{{ $json.session_id }}.mp3', updated_at = NOW() WHERE id = {{ $json.session_id }};",
        "options": {}
      },
      "id": "update-step-video",
      "name": "üìå –®–∞–≥ ‚Üí –í–∏–¥–µ–æ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [1900, 560],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.minimaxi.chat/v1/video_generation",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"video-01\",\n  \"prompt\": \"{{ $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.prompt_text }}\",\n  \"first_frame_image\": \"{{ $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.product_image_url || '' }}\"\n}",
        "options": { "timeout": 300000 }
      },
      "id": "video-generate",
      "name": "üé• –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (Minimax)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2140, 560],
      "credentials": {
        "httpHeaderAuth": {
          "id": "MINIMAX_CREDENTIAL_ID",
          "name": "Minimax Video API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $json.body || $json;\nconst taskId = response.task_id;\n\nif (!taskId) {\n  throw new Error('Minimax –Ω–µ –≤–µ—Ä–Ω—É–ª task_id: ' + JSON.stringify(response));\n}\n\nreturn [{ json: {\n  task_id: taskId,\n  session_id: $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json.session_id,\n  poll_count: 0\n}}];"
      },
      "id": "extract-task-id",
      "name": "üîë –ò–∑–≤–ª–µ—á—å task_id",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2380, 560]
    },
    {
      "parameters": {
        "amount": 15,
        "unit": "seconds"
      },
      "id": "wait-poll",
      "name": "‚è≥ –ñ–¥–∞—Ç—å 15 —Å–µ–∫",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [2620, 560]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://api.minimaxi.chat/v1/query/video_generation?task_id={{ $json.task_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "options": { "timeout": 30000 }
      },
      "id": "poll-video",
      "name": "üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2860, 560],
      "credentials": {
        "httpHeaderAuth": {
          "id": "MINIMAX_CREDENTIAL_ID",
          "name": "Minimax Video API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            {
              "id": "video-ready",
              "leftValue": "={{ $json.status || $json.body?.status }}",
              "rightValue": "Success",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-video-status",
      "name": "‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [3100, 560]
    },
    {
      "parameters": {
        "jsCode": "const prev = $input.first().json;\nconst pollCount = (prev.poll_count || 0) + 1;\n\nif (pollCount > 40) {\n  throw new Error('–¢–∞–π–º–∞—É—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ: 40 –ø–æ–ø—ã—Ç–æ–∫ (10 –º–∏–Ω)');\n}\n\nreturn [{ json: {\n  task_id: prev.task_id || $('üîë –ò–∑–≤–ª–µ—á—å task_id').first().json.task_id,\n  session_id: prev.session_id || $('üîë –ò–∑–≤–ª–µ—á—å task_id').first().json.session_id,\n  poll_count: pollCount\n}}];"
      },
      "id": "increment-poll",
      "name": "‚è≥ –ï—â—ë –Ω–µ –≥–æ—Ç–æ–≤–æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3340, 760]
    },
    {
      "parameters": {
        "jsCode": "const response = $json.body || $json;\nconst videoUrl = response.file_id || response.video_url || '';\n\nif (!videoUrl) {\n  throw new Error('Minimax –Ω–µ –≤–µ—Ä–Ω—É–ª URL –≤–∏–¥–µ–æ');\n}\n\nconst sessionId = $('üîë –ò–∑–≤–ª–µ—á—å task_id').first().json.session_id;\n\nreturn [{ json: {\n  session_id: sessionId,\n  raw_video_url: videoUrl,\n  ...$('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json\n}}];"
      },
      "id": "extract-video-url",
      "name": "üé¨ URL –≤–∏–¥–µ–æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3340, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET current_step = 'montage', raw_video_url = '{{ $json.raw_video_url }}', updated_at = NOW() WHERE id = {{ $json.session_id }};",
        "options": {}
      },
      "id": "update-step-montage",
      "name": "üìå –®–∞–≥ ‚Üí –ú–æ–Ω—Ç–∞–∂",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [3580, 400],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SRT —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –∏–∑ timing_marks\nconst data = $('üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö').first().json;\nconst sessionId = data.session_id;\nconst timingMarks = data.timing_marks || [];\n\nif (timingMarks.length === 0) {\n  const words = (data.script_text || '').split(/\\s+/);\n  const chunkSize = 6;\n  let srt = '';\n  let idx = 1;\n  for (let i = 0; i < words.length; i += chunkSize) {\n    const chunk = words.slice(i, i + chunkSize).join(' ');\n    const startSec = Math.floor(i / chunkSize) * 3;\n    const endSec = startSec + 3;\n    srt += `${idx}\\n${fmtSRT(startSec)} --> ${fmtSRT(endSec)}\\n${chunk}\\n\\n`;\n    idx++;\n  }\n  return [{ json: { session_id: sessionId, srt_content: srt } }];\n}\n\nlet srt = '';\nfor (let i = 0; i < timingMarks.length; i++) {\n  const mark = timingMarks[i];\n  const nextMark = timingMarks[i + 1];\n  srt += `${i + 1}\\n${fmtSRT(mark.time)} --> ${fmtSRT(nextMark ? nextMark.time : mark.time + 3)}\\n${mark.text}\\n\\n`;\n}\n\nreturn [{ json: { session_id: sessionId, srt_content: srt } }];\n\nfunction fmtSRT(sec) {\n  const h = String(Math.floor(sec / 3600)).padStart(2, '0');\n  const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');\n  const s = String(Math.floor(sec % 60)).padStart(2, '0');\n  return `${h}:${m}:${s},000`;\n}"
      },
      "id": "generate-srt",
      "name": "üìù –°—É–±—Ç–∏—Ç—Ä—ã SRT",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3580, 600]
    },
    {
      "parameters": {
        "command": "=echo '{{ $json.srt_content }}' > /home/node/output/subs_{{ $json.session_id }}.srt",
        "options": {}
      },
      "id": "save-srt",
      "name": "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å SRT",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [3820, 600]
    },
    {
      "parameters": {
        "jsCode": "const data = $('üé¨ URL –≤–∏–¥–µ–æ').first().json;\nconst sessionId = data.session_id;\n\nlet cmd = 'ffmpeg -y';\ncmd += ` -i /home/node/output/raw_${sessionId}.mp4`;\ncmd += ` -i /home/node/output/voice_${sessionId}.mp3`;\n\nlet filters = [];\nfilters.push('[0:v]scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2[base]');\n\nconst sf = data.subtitle_font || 'Arial';\nconst ss = data.subtitle_size || 42;\nconst so = data.subtitle_outline || 2;\nfilters.push(`[base]subtitles=/home/node/output/subs_${sessionId}.srt:force_style='FontName=${sf},FontSize=${ss},PrimaryColour=&H00FFFFFF,OutlineColour=&H00000000,Outline=${so},Alignment=2'[subbed]`);\n\nlet lastLabel = 'subbed';\n\nif (data.watermark_url) {\n  cmd += ` -i /home/node/output/watermark_${sessionId}.png`;\n  const pos = data.watermark_position || 'top-right';\n  let x = 'W-w-20', y = '20';\n  if (pos === 'top-left') { x = '20'; y = '20'; }\n  else if (pos === 'bottom-left') { x = '20'; y = 'H-h-20'; }\n  else if (pos === 'bottom-right') { x = 'W-w-20'; y = 'H-h-20'; }\n  const opacity = data.watermark_opacity || 0.7;\n  filters.push(`[2:v]format=rgba,colorchannelmixer=aa=${opacity}[wm]`);\n  filters.push(`[${lastLabel}][wm]overlay=${x}:${y}[watermarked]`);\n  lastLabel = 'watermarked';\n}\n\nif (data.show_artikul && data.artikul) {\n  filters.push(`[${lastLabel}]drawtext=text='${data.artikul}':fontsize=36:fontcolor=white:borderw=2:bordercolor=black:x=20:y=H-h-60[final]`);\n  lastLabel = 'final';\n}\n\ncmd += ` -filter_complex \"${filters.join(';')}\" -map \"[${lastLabel}]\" -map 1:a`;\ncmd += ' -c:v libx264 -preset fast -crf 23 -c:a aac -b:a 128k -shortest';\ncmd += ` /home/node/output/final_${sessionId}.mp4`;\n\nreturn [{ json: { session_id: sessionId, ffmpeg_cmd: cmd } }];"
      },
      "id": "build-ffmpeg",
      "name": "üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4060, 400]
    },
    {
      "parameters": {
        "command": "={{ $json.ffmpeg_cmd }}",
        "options": { "timeout": 300000 }
      },
      "id": "run-ffmpeg",
      "name": "‚ö° FFmpeg –º–æ–Ω—Ç–∞–∂",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [4300, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET \n  status = 'ready_for_review',\n  current_step = 'review',\n  final_video_url = '/output/final_{{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }}.mp4',\n  updated_at = NOW()\nWHERE id = {{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }};",
        "options": {}
      },
      "id": "save-final",
      "name": "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [4540, 400],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://dashboard:3001/api/internal/video-ready",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"session_id\": {{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }},\n  \"final_video_url\": \"/output/final_{{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }}.mp4\",\n  \"status\": \"ready_for_review\"\n}",
        "options": {}
      },
      "id": "callback-dashboard",
      "name": "üì° Callback ‚Üí Dashboard",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [4780, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"chat_id\": \"–ó–ê–ú–ï–ù–ò–¢–ï_–ù–ê_–í–ê–®_CHAT_ID\",\n  \"text\": \"üé¨ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ!\\n\\n–°–µ—Å—Å–∏—è: #{{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }}\\n\\nüëâ http://dashboard:3001/videos/{{ $('üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg').first().json.session_id }}\",\n  \"parse_mode\": \"HTML\"\n}",
        "options": {}
      },
      "id": "notify-telegram",
      "name": "üì¨ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [5020, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://dashboard:3001/api/internal/log-error",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"workflow_name\": \"video-factory\",\n  \"session_id\": {{ $json.session_id || 0 }},\n  \"error_message\": \"{{ $json.error?.message || 'Unknown error' }}\",\n  \"node_name\": \"{{ $json.error?.node || '' }}\"\n}",
        "options": {}
      },
      "id": "error-handler",
      "name": "‚ùå –õ–æ–≥ –æ—à–∏–±–∫–∏",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2140, 800]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pipeline_sessions SET status = 'error', error_message = '{{ $json.error?.message || \"Unknown\" }}', error_step = '{{ $json.error?.node || '' }}', updated_at = NOW() WHERE id = {{ $json.session_id || 0 }};",
        "options": {}
      },
      "id": "mark-error",
      "name": "‚ö†Ô∏è –ü–æ–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫—É",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [2380, 800],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "Content Factory DB"
        }
      }
    }
  ],
  "connections": {
    "üì• Webhook": {
      "main": [
        [{ "node": "üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞", "type": "main", "index": 0 }]
      ]
    },
    "üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞": {
      "main": [
        [
          { "node": "‚úÖ –û—Ç–≤–µ—Ç 200", "type": "main", "index": 0 },
          { "node": "üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö", "type": "main", "index": 0 }
        ]
      ]
    },
    "üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö": {
      "main": [
        [{ "node": "üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö", "type": "main", "index": 0 }]
      ]
    },
    "üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö": {
      "main": [
        [{ "node": "üìå –®–∞–≥ ‚Üí TTS", "type": "main", "index": 0 }]
      ]
    },
    "üìå –®–∞–≥ ‚Üí TTS": {
      "main": [
        [{ "node": "üîä TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è", "type": "main", "index": 0 }]
      ]
    },
    "üîä TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è": {
      "main": [
        [{ "node": "üéµ –û–±—Ä–∞–±–æ—Ç–∫–∞ TTS", "type": "main", "index": 0 }]
      ]
    },
    "üéµ –û–±—Ä–∞–±–æ—Ç–∫–∞ TTS": {
      "main": [
        [{ "node": "üìå –®–∞–≥ ‚Üí –í–∏–¥–µ–æ", "type": "main", "index": 0 }]
      ]
    },
    "üìå –®–∞–≥ ‚Üí –í–∏–¥–µ–æ": {
      "main": [
        [{ "node": "üé• –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (Minimax)", "type": "main", "index": 0 }]
      ]
    },
    "üé• –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (Minimax)": {
      "main": [
        [{ "node": "üîë –ò–∑–≤–ª–µ—á—å task_id", "type": "main", "index": 0 }]
      ]
    },
    "üîë –ò–∑–≤–ª–µ—á—å task_id": {
      "main": [
        [{ "node": "‚è≥ –ñ–¥–∞—Ç—å 15 —Å–µ–∫", "type": "main", "index": 0 }]
      ]
    },
    "‚è≥ –ñ–¥–∞—Ç—å 15 —Å–µ–∫": {
      "main": [
        [{ "node": "üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å", "type": "main", "index": 0 }]
      ]
    },
    "üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å": {
      "main": [
        [{ "node": "‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ?", "type": "main", "index": 0 }]
      ]
    },
    "‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ?": {
      "main": [
        [{ "node": "üé¨ URL –≤–∏–¥–µ–æ", "type": "main", "index": 0 }],
        [{ "node": "‚è≥ –ï—â—ë –Ω–µ –≥–æ—Ç–æ–≤–æ", "type": "main", "index": 0 }]
      ]
    },
    "‚è≥ –ï—â—ë –Ω–µ –≥–æ—Ç–æ–≤–æ": {
      "main": [
        [{ "node": "‚è≥ –ñ–¥–∞—Ç—å 15 —Å–µ–∫", "type": "main", "index": 0 }]
      ]
    },
    "üé¨ URL –≤–∏–¥–µ–æ": {
      "main": [
        [{ "node": "üìå –®–∞–≥ ‚Üí –ú–æ–Ω—Ç–∞–∂", "type": "main", "index": 0 }]
      ]
    },
    "üìå –®–∞–≥ ‚Üí –ú–æ–Ω—Ç–∞–∂": {
      "main": [
        [
          { "node": "üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg", "type": "main", "index": 0 },
          { "node": "üìù –°—É–±—Ç–∏—Ç—Ä—ã SRT", "type": "main", "index": 0 }
        ]
      ]
    },
    "üìù –°—É–±—Ç–∏—Ç—Ä—ã SRT": {
      "main": [
        [{ "node": "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å SRT", "type": "main", "index": 0 }]
      ]
    },
    "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å SRT": {
      "main": [
        [{ "node": "üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg", "type": "main", "index": 0 }]
      ]
    },
    "üéûÔ∏è –°–±–æ—Ä–∫–∞ FFmpeg": {
      "main": [
        [{ "node": "‚ö° FFmpeg –º–æ–Ω—Ç–∞–∂", "type": "main", "index": 0 }]
      ]
    },
    "‚ö° FFmpeg –º–æ–Ω—Ç–∞–∂": {
      "main": [
        [{ "node": "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç", "type": "main", "index": 0 }]
      ]
    },
    "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç": {
      "main": [
        [{ "node": "üì° Callback ‚Üí Dashboard", "type": "main", "index": 0 }]
      ]
    },
    "üì° Callback ‚Üí Dashboard": {
      "main": [
        [{ "node": "üì¨ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ", "type": "main", "index": 0 }]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": ""
  },
  "staticData": null,
  "tags": [{ "name": "content-factory" }],
  "triggerCount": 1,
  "updatedAt": "2025-01-01T00:00:00.000Z",
  "versionId": "2"
}
