# ๐ญ Workflows โ ะะพะฝัะตะฝั ะะฐะฒะพะด

## ะะฑะทะพั

ะขัะธ ัะฐะฑะพัะธั ะฟัะพัะตััะฐ N8N, ะบะพัะพััะต ะพะฑัะฐะทััั ะฟะพะปะฝัะน ะบะพะฝะฒะตะนะตั ะฟัะพะธะทะฒะพะดััะฒะฐ ะฒะธะดะตะพะบะพะฝัะตะฝัะฐ:

```
01 ะะพะฝัะตะฝั-ะผะพะทะณ โ 02 ะะธะดะตะพ-ัะฐะฑัะธะบะฐ โ 03 ะัะฑะปะธะบะฐัะธั
    (ะธะดะตะธ)         (ะฒะธะดะตะพ)           (ัะพััะตัะธ)
```

ะัะต AI-ะบะปััะธ ััะฐะฝัััั **ะฒะฝัััะธ N8N Credentials** (ะทะฐัะธััะพะฒะฐะฝะพ), ะฐ ะฝะต ะฒ `.env` ัะฐะนะปะต.  
ะะฐัััะพะนะบะธ ะผะพะดะตะปะธ / URL / ะฟัะพะผะฟัะฐ ััะฐะฝัััั ะฒ ัะฐะฑะปะธัะต `app_settings` ะฒ PostgreSQL.

---

## ๐ ะกะฟะธัะพะบ Workflow

### 01 โ ะะพะฝัะตะฝั-ะผะพะทะณ (`01-content-brain.json`)

**ะะฐะทะฝะฐัะตะฝะธะต:** AI ะณะตะฝะตัะธััะตั ะธะดะตะธ โ ััะตะฝะฐัะธะธ โ ะฒะธะดะตะพ-ะฟัะพะผะฟัั

**ะขัะธะณะณะตั:** Webhook `POST /webhook/content-brain` ะธะปะธ Cron (ะพัะบะปัััะฝ ะฟะพ ัะผะพะปัะฐะฝะธั)

**ะะพะดั:**
| # | ะะพะดะฐ | ะงัะพ ะดะตะปะฐะตั |
|---|------|------------|
| 1 | ๐ฅ Webhook / โฐ Cron | ะัะธะฝะธะผะฐะตั ะทะฐะฟัะพั ะธะปะธ ััะฐะฑะฐััะฒะฐะตั ะฟะพ ัะฐัะฟะธัะฐะฝะธั |
| 2 | โ๏ธ ะะฐัััะพะนะบะธ ะธะท ะะ | ะะฐะณััะถะฐะตั `ai_model`, `ai_base_url`, `ai_system_prompt` ะธะท `app_settings` |
| 3 | ๐ง ะะพะดะณะพัะพะฒะบะฐ ะบะพะฝัะธะณะฐ | ะะฑัะตะดะธะฝัะตั ะฝะฐัััะพะนะบะธ ะธะท ะะ ะธ ะฒัะพะดะฝัะต ะฟะฐัะฐะผะตััั webhook |
| 4 | ๐ง ะะตะฝะตัะฐัะธั ะธะดะตะน | AI ัะตัะตะท HTTP Request โ `/chat/completions` |
| 5 | ๐ ะะฐััะธะฝะณ ะธะดะตะน | ะะทะฒะปะตะบะฐะตั JSON ะธะท ะพัะฒะตัะฐ AI |
| 6 | ๐พ ะกะพััะฐะฝะตะฝะธะต ะธะดะตะน | INSERT ะฒ `content_ideas` ัะตัะตะท PostgreSQL |
| 7 | ๐ ะะตะฝะตัะฐัะธั ััะตะฝะฐัะธั | AI ัะพะทะดะฐัั ะณะพะปะพัะพะฒะพะน ััะตะฝะฐัะธะน ะฝะฐ ะพัะฝะพะฒะต ะธะดะตะธ |
| 8 | ๐ฌ ะะตะฝะตัะฐัะธั ะฒะธะดะตะพ-ะฟัะพะผะฟัะฐ | AI ัะพะทะดะฐัั ะฟัะพะผะฟั ะดะปั ะณะตะฝะตัะฐัะธะธ ะฒะธะดะตะพ |
| 9 | ๐ก Callback โ Dashboard | ะฃะฒะตะดะพะผะปัะตั Dashboard ะพ ะณะพัะพะฒะฝะพััะธ ะบะพะฝัะตะฝัะฐ |
| 10 | ๐ค ะัะฒะตั webhook | ะะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐั |

**Credentials:**

- `httpHeaderAuth` โ **AI Provider** (ะดะปั AI-ะทะฐะฟัะพัะพะฒ)
- `postgres` โ **Content Factory DB** (ะดะปั ะทะฐะฟะธัะธ ะฒ ะะ)

---

### 02 โ ะะธะดะตะพ-ัะฐะฑัะธะบะฐ (`02-video-factory.json`)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะทะฒััะบะฐ โ ะณะตะฝะตัะฐัะธั ะฒะธะดะตะพ โ ะผะพะฝัะฐะถ ั ััะฑัะธััะฐะผะธ ะธ ะฒะพะดัะฝัะผ ะทะฝะฐะบะพะผ

**ะขัะธะณะณะตั:** Webhook `POST /webhook/video-factory`

**ะะพะดั:**
| # | ะะพะดะฐ | ะงัะพ ะดะตะปะฐะตั |
|---|------|------------|
| 1 | ๐ฅ Webhook | ะัะธะฝะธะผะฐะตั ะทะฐะฟัะพั ั `session_id` |
| 2 | ๐ ะะฐะปะธะดะฐัะธั | ะัะพะฒะตััะตั ะฒัะพะดะฝัะต ะดะฐะฝะฝัะต |
| 3 | โ ะัะฒะตั 200 | ะะตะผะตะดะปะตะฝะฝัะน ะพัะฒะตั (async processing) |
| 4 | ๐ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั | ะะฐะณััะถะฐะตั ััะตะฝะฐัะธะน, ะฟัะพะผะฟั, ะดะฐะฝะฝัะต ะธะท ะะ |
| 5 | ๐ TTS ะณะตะฝะตัะฐัะธั | ะะทะฒััะบะฐ ัะตัะตะท OpenAI TTS API |
| 6 | ๐ฅ Minimax ะฒะธะดะตะพ | ะะตะฝะตัะฐัะธั ะฒะธะดะตะพ ัะตัะตะท Minimax API |
| 7 | ๐ ะะพะปะธะฝะณ ััะฐัััะฐ | ะฆะธะบะป ะพะถะธะดะฐะฝะธั ะณะพัะพะฒะฝะพััะธ ะฒะธะดะตะพ (ะดะพ 10 ะผะธะฝ) |
| 8 | ๐ ะกัะฑัะธััั SRT | ะะตะฝะตัะฐัะธั ัะฐะนะปะฐ ััะฑัะธััะพะฒ |
| 9 | ๐๏ธ FFmpeg ะผะพะฝัะฐะถ | ะกะฑะพัะบะฐ: ะฒะธะดะตะพ + ะฐัะดะธะพ + ััะฑัะธััั + ะฒะพะดัะฝะพะน ะทะฝะฐะบ |
| 10 | ๐ก Callback | ะฃะฒะตะดะพะผะปะตะฝะธะต Dashboard |
| 11 | ๐ฌ Telegram | ะฃะฒะตะดะพะผะปะตะฝะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะพัะบะปัััะฝ) |

**Credentials:**

- `httpHeaderAuth` โ **TTS Provider** (OpenAI / ElevenLabs)
- `httpHeaderAuth` โ **Minimax Video API**
- `httpHeaderAuth` โ **Telegram Bot** (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `postgres` โ **Content Factory DB**

---

### 03 โ ะัะฑะปะธะบะฐัะธั (`03-publisher.json`)

**ะะฐะทะฝะฐัะตะฝะธะต:** AI-ะณะตะฝะตัะฐัะธั ะพะฟะธัะฐะฝะธั + ะฟัะฑะปะธะบะฐัะธั ะฒ Telegram / VK

**ะขัะธะณะณะตั:** Webhook `POST /webhook/publisher`

**ะะพะดั:**
| # | ะะพะดะฐ | ะงัะพ ะดะตะปะฐะตั |
|---|------|------------|
| 1 | ๐ฅ Webhook | ะัะธะฝะธะผะฐะตั ะทะฐะฟัะพั ั `session_id` ะธ `channels` |
| 2 | โ๏ธ ะะฐัััะพะนะบะธ ะธะท ะะ | ะะฐะณััะถะฐะตั AI-ะฝะฐัััะพะนะบะธ |
| 3 | ๐ ะะฐะณััะทะบะฐ ัะตััะธะธ | ะะฐะณััะถะฐะตั ะดะฐะฝะฝัะต ัะตััะธะธ ะธะท ะะ |
| 4 | ๐ง AI โ ะะฟะธัะฐะฝะธะต | ะะตะฝะตัะฐัะธั ัะตะบััะฐ ะฟะพััะฐ ัะตัะตะท AI |
| 5 | ๐ ะะฐะทะดะตะปะธัั ะบะฐะฝะฐะปั | ะะฐะทะดะตะปัะตั ะฝะฐ ะพัะดะตะปัะฝัะต ะฟัะฑะปะธะบะฐัะธะธ |
| 6 | ๐ฌ Telegram / ๐ VK | ะัะฑะปะธะบะฐัะธั ะฒ ะฒัะฑัะฐะฝะฝัะต ะบะฐะฝะฐะปั |
| 7 | ๐พ ะกะพััะฐะฝะตะฝะธะต | ะะฐะฟะธัั ะฒ ัะฐะฑะปะธัั `publications` |
| 8 | ๐ก Callback | ะฃะฒะตะดะพะผะปะตะฝะธะต Dashboard |

**Credentials:**

- `httpHeaderAuth` โ **AI Provider** (ะดะปั ะณะตะฝะตัะฐัะธะธ ะพะฟะธัะฐะฝะธั)
- `httpHeaderAuth` โ **Telegram Bot**
- `httpHeaderAuth` โ **VK API Token**
- `postgres` โ **Content Factory DB**

---

## ๐ ะะฐัััะพะนะบะฐ Credentials ะฒ N8N

> **ะะพัะตะผั ัะตัะตะท Credentials, ะฐ ะฝะต `.env`?**  
> N8N ัะธัััะตั credentials ั ะฟะพะผะพััั `N8N_ENCRYPTION_KEY`.  
> ะะปััะธ ะฒ `.env` ััะฐะฝัััั ะฒ ะพัะบัััะพะผ ะฒะธะดะต โ ััะพ ะฝะตะฑะตะทะพะฟะฐัะฝะพ.

### ะจะฐะณ 1: Postgres Credential

1. ะัะบัะพะนัะต N8N โ **Settings โ Credentials โ Add Credential**
2. ะขะธะฟ: **Postgres**
3. ะะฐะฟะพะปะฝะธัะต:
   - **Host:** `postgres`
   - **Database:** ะฒะฐัะฐ ะะ (ะทะฝะฐัะตะฝะธะต `DB_POSTGRESDB_DATABASE` ะธะท `.env`)
   - **User:** `DB_POSTGRESDB_USER`
   - **Password:** `DB_POSTGRESDB_PASSWORD`
   - **Port:** `5432`
4. **ะะผั:** `Content Factory DB`
5. ะะฐะถะผะธัะต **Save**

### ะจะฐะณ 2: AI Credential (Header Auth)

1. **Add Credential** โ ะขะธะฟ: **Header Auth**
2. ะะฐะฟะพะปะฝะธัะต:
   - **Header Name:** `Authorization`
   - **Header Value:** `Bearer ะะะจ_API_ะะะฎะง`

   > ะัะธะผะตัั:
   >
   > - GPTunnel: `Bearer sk-gpt-xxx`
   > - OpenAI: `Bearer sk-xxx`
   > - OpenRouter: `Bearer sk-or-xxx`

3. **ะะผั:** `AI Provider (GPTunnel / OpenAI / OpenRouter)`

### ะจะฐะณ 3: TTS Credential

1. ะขะธะฟ: **Header Auth**
2. **Header Name:** `Authorization`
3. **Header Value:** `Bearer ะะะจ_OPENAI_KEY` (ะธะปะธ ElevenLabs key)
4. **ะะผั:** `TTS Provider (OpenAI / ElevenLabs)`

### ะจะฐะณ 4: Minimax Credential

1. ะขะธะฟ: **Header Auth**
2. **Header Name:** `Authorization`
3. **Header Value:** `Bearer ะะะจ_MINIMAX_KEY`
4. **ะะผั:** `Minimax Video API`

### ะจะฐะณ 5: Telegram Bot Credential

1. ะขะธะฟ: **Header Auth**
2. **Header Name:** ะพััะฐะฒััะต ะฟััััะผ (ัะพะบะตะฝ ะฟะตัะตะดะฐัััั ะฒ URL)
3. **ะะผั:** `Telegram Bot`

> ะะปะธ ะธัะฟะพะปัะทัะนัะต ะฒัััะพะตะฝะฝัะน ัะธะฟ **Telegram API** ั BotFather ัะพะบะตะฝะพะผ.

### ะจะฐะณ 6: VK Credential

1. ะขะธะฟ: **Header Auth**
2. **Header Name:** `Authorization`
3. **Header Value:** `Bearer ะะะจ_VK_TOKEN`
4. **ะะผั:** `VK API Token`

---

## โ๏ธ ะะฐัััะพะนะบะธ AI ัะตัะตะท Dashboard

ะะผะตััะพ env-ะฟะตัะตะผะตะฝะฝัั, ะฝะฐัััะพะนะบะธ AI ััะฐะฝัััั ะฒ ัะฐะฑะปะธัะต `app_settings`:

| ะะปัั               | ะะฟะธัะฐะฝะธะต         | ะัะธะผะตั                          |
| ------------------ | ---------------- | ------------------------------- |
| `ai_model`         | ะะพะดะตะปั AI        | `gpt-4o-mini`                   |
| `ai_base_url`      | ะะฐะทะพะฒัะน URL API  | `https://gptunnel.ru/v1`        |
| `ai_system_prompt` | ะกะธััะตะผะฝัะน ะฟัะพะผะฟั | `ะขั โ ัะบัะฟะตัั ะฟะพ ะผะฐัะบะตัะธะฝะณั...` |

**ะะตะฝััั ัะตัะตะท:** Dashboard โ ะะฐัััะพะนะบะธ โ AI

ะะฐะถะดัะน workflow ะฟัะธ ะทะฐะฟััะบะต ัะธัะฐะตั ะฝะฐัััะพะนะบะธ ะธะท ะะ ะฐะฒัะพะผะฐัะธัะตัะบะธ.

---

## ๐ ะะผะฟะพัั Workflow ะฒ N8N

### ะะฒัะพะผะฐัะธัะตัะบะธ (ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต)

Workflow ัะฐะนะปั ะผะพะฝัะธัััััั ะฒ ะบะพะฝัะตะนะฝะตั N8N ัะตัะตะท Docker volume:

```yaml
volumes:
  - ./workflows:/home/node/workflows
```

### ะัััะฝัั (ัะตัะตะท UI)

1. ะัะบัะพะนัะต N8N: `http://ะฒะฐั-ัะตัะฒะตั:5678`
2. **Workflows โ Import from File**
3. ะัะฑะตัะธัะต JSON ัะฐะนะป
4. **ะะฑัะทะฐัะตะปัะฝะพ:** ะพะฑะฝะพะฒะธัะต Credential references (ัะผ. ะฝะธะถะต)

### ะะฐะผะตะฝะฐ Credential ID

ะ JSON ัะฐะนะปะฐั ะธัะฟะพะปัะทััััั ะฟะปะตะนััะพะปะดะตัั. ะะพัะปะต ะธะผะฟะพััะฐ ะทะฐะผะตะฝะธัะต ะฝะฐ ัะตะฐะปัะฝัะต ID:

| ะะปะตะนััะพะปะดะตั              | ะะฐ ััะพ ะผะตะฝััั                 |
| ------------------------ | ----------------------------- |
| `POSTGRES_CREDENTIAL_ID` | ID ะฒะฐัะตะณะพ Postgres credential |
| `AI_CREDENTIAL_ID`       | ID ะฒะฐัะตะณะพ AI credential       |
| `TTS_CREDENTIAL_ID`      | ID TTS credential             |
| `MINIMAX_CREDENTIAL_ID`  | ID Minimax credential         |
| `TELEGRAM_CREDENTIAL_ID` | ID Telegram credential        |
| `VK_CREDENTIAL_ID`       | ID VK credential              |

> ๐ก **ะะฐะบ ะฝะฐะนัะธ ID:** ะฒ N8N ะพัะบัะพะนัะต credential โ ะฟะพัะผะพััะธัะต ID ะฒ ะฐะดัะตัะฝะพะน ัััะพะบะต ะฑัะฐัะทะตัะฐ

---

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
workflows/
โโโ 01-content-brain.json   # ๐ง AI ะณะตะฝะตัะฐัะธั ะบะพะฝัะตะฝัะฐ
โโโ 02-video-factory.json   # ๐ฌ ะัะพะธะทะฒะพะดััะฒะพ ะฒะธะดะตะพ
โโโ 03-publisher.json       # ๐ก ะัะฑะปะธะบะฐัะธั ะฒ ัะพััะตัะธ
โโโ README.md               # ๐ ะญัะพั ัะฐะนะป
```
